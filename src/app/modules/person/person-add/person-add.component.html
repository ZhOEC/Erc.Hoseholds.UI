<nz-card nzTitle="Персона">
  <form nz-form [formGroup]="personForm">
    <div nz-row nzType="flex" nzJustify="center">
      <div nz-col nzXs="17" nzSm="17" nzMd="14" nzLg="6" nzXl="5" nzXXl="4">
        <button nz-button type="button" nzType="primary" (click)="personInputsTrigger()">Додати нового споживача</button>
      </div>
      <div nz-col nzXs="17" nzSm="17" nzMd="14" nzLg="2" nzXl="2" nzXXl="2">
        <span> - або - </span>
      </div>
      <div nz-col nzXs="17" nzSm="17" nzMd="14" nzLg="12" nzXl="11" nzXXl="11">
        <nz-form-item>
          <nz-form-control nzErrorTip="Не обрано споживача">
            <nz-select 
              nzShowSearch
              nzServerSearch
              formControlName="searchPerson"
              nzPlaceHolder="Пошук за паспортом або ІПН"
              (nzOnSearch)="searchPerson($event)"
              (ngModelChange)="setDataPerson($event)"
              [nzCustomTemplate]="selectedPersonTemplate" 
              [nzLoading]="isLoadingSearch"
              [nzOptionHeightPx]="54"
              nzOptionOverflowSize="3">
                <nz-option nzCustomContent *ngFor="let person of findPersons" [nzLabel]="person" [nzValue]="person">
                  <b>ПІБ:</b> {{person.lastName}} {{person.firstName}} {{person.patronymic}} <br/>
                  <b>Номер паспорта:</b> {{person.idCardNumber}} <b>Іден. номер:</b> {{person.taxCode}}
                </nz-option>
            </nz-select>
            <ng-template #selectedPersonTemplate let-person>
              <span>{{ person.nzLabel.lastName }} {{ person.nzLabel.firstName }} {{ person.nzLabel.patronymic }}
                <b>{{ person.nzLabel.taxCode }} : {{ person.nzLabel.idCardNumber }}</b></span>
            </ng-template>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>

    <div *ngIf="isPersonInputsShown">
      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="taxCode">ІНН</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено ІНН">
          <input type="text" nz-input formControlName="taxCode"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="idCardNumber">Номер паспорту</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено номер паспорту">
          <input type="text" nz-input formControlName="idCardNumber"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="idCardIssuer">Ким виданий</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено ким виданий">
          <input type="text" nz-input formControlName="idCardIssuer"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="idCardIssuanceDate">Дата видачі</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не обрано дату видачі">
          <nz-date-picker nzFormat="dd.MM.yyyy" formControlName="idCardIssuanceDate" [nzDisabledDate]="datesMoreToday"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>
      
      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="idCardExpirationDate">Дата закінчення ID картки</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не обрано дату закінчення ID картки">
          <nz-date-picker nzFormat="dd.MM.yyyy" formControlName="idCardExpirationDate" [nzDisabledDate]="datesLessToday"></nz-date-picker>
        </nz-form-control>
      </nz-form-item>
      
      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="firstName">Ім'я</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено ім'я">
          <input type="text" nz-input formControlName="firstName"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="lastName">Прізвище</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено прізвище">
          <input type="text" nz-input formControlName="lastName"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzRequired nzFor="patronymic">По батькові</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено по батькові">
          <input type="text" nz-input formControlName="patronymic"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="7" nzFor="mobilePhones">Номери мобільних телефонів</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено жодного номера телефону">
          <nz-select formControlName="mobilePhones" nzMode="tags" [nzTokenSeparators]="[',']"></nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="7" [nzRequired]="!personForm.get('requiredPaperInvoice')?.value" nzFor="email">Електронна пошта (email)</nz-form-label>
        <nz-form-control [nzSpan]="10" nzErrorTip="Не введено адресу електронної пошти">
          <input type="email" nz-input formControlName="email"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-control [nzSpan]="10" [nzOffset]="7">
          <label nz-checkbox formControlName="requiredPaperInvoice" (ngModelChange)="requiredPaperInvoiceChange($event)">Отримувати паперову квитанцію</label>
        </nz-form-control>
      </nz-form-item>
    </div>
  </form>
</nz-card>